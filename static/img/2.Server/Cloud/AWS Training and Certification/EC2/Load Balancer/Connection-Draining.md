---
slug: "Connection-Draining"
---
# Connection Draining
:::note 다른 이름이 존재한다.
- Connection Draning - for CLB
- Deregisteration Delay  - for ALB & NLB

:::

- 인스턴스가 등록 취소, 혹은 비 정상적인 상태에 있을 때, 인스턴스에 어느 정도의 시간을 주어 `in-flight request` 즉, 활성 요청을 완료 할 수 있도록 하는 기능입니다.
- 연결이 드레이닝 되면, 즉 인스턴스가 드레이닝되면
- ELB는 등록 취소 중인 EC2 인스턴스로 새로운 요청을 보내지 않는 겁니다.
![Pasted image 20231204101538.png](../../../../../Pasted image 20231204101538.png)
- 위의 사진으로 예를 들자면, EC2 인스턴스가 3개가 존재할 때
- 그 중 하나를 <mark>드레이닝 모드</mark>로 설정합니다.
- 그러면 EC2 인스턴스에 이미 연결된 유저는 충분한 드레이닝 시간을 얻게 될 겁니다.
- 기존 연결 및 기존 요청을 완료 할 수 있을 겁니다.
- 그리고 작업이 끝나면 모든 연결이 정지 됩니다.
- 만약 새로운 유저가 ELB에 연결하려고 하면, ELB는 기존의 EC2 인스턴스가 드레이닝 상태에 있으므로, 새로운 연결은 다른 EC2 인스턴스와 수립 될 거라는 점을 알고 있습니다.
- 두 번째나 세 번째 EC2 인스턴스를 사용할 것입니다.
- 연결 드레이닝 파라미터는 매개변수로 표시할 수 있습니다.
- 1 ~ 3,600초 사이의 값으로 설정할 수 있는데 기본적으로 300초, 즉 5분 입니다.
- 그리고 이 값을 0으로 설정하면 전부 다 비활성화 할 수 있습니다.
- 값이 0이면 드레이닝도 일어나지 않는다는 뜻입니다.
- 짧은 요청의 경우에는 낮은 값으로 설정하며 좋습니다.
	- 예를 들어 1초보다 적은 아주 짧은 요청인 경우에는 연결 드레이닝 파라미터를 30초 정도로 설정하면 됩니다.
	- 그래야 EC2 인스턴스가 빠르게 드레이닝 될 테고, 그 후 오프라인 상태가 되어 교체 등의 작업을 할 수 있습니다.
- 요청 시간이 매우 긴 업로드 또는 오래 지속되는 요청 등의 경우에는 어느 정도 높은 값으로 설정하면 됩니다.
- 그러면 EC2 인스턴스가 금방 사라지지 않을 것입니다.




