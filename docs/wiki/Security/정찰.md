# 웹 애플리케이션 정찰
일반적으로 웹 애플리케이션 정찰은 웹 애플리케이션을 해킹하기에 앞서, 이뤄지는 탐색적 데이터 수집 단계다.
웹 애플리케이션 정찰은 해커, 침투 테스터, 버그 바운티 헌터가 행하는 것이 일반적이다.

하지만 악의적 행위자가 웹 애플리케이션의 약점을 찾기 전에 보안 엔지니어가 먼저 발견해서 패치하는 것이 효과적이다.
정찰 기술 자체는 크게 중요하지 않지만, 해킹 공격 지식과 방어에 대한 보안 엔지니어링 경험을 결합하면 가치가 높아진다.

## 정보 수집
정찰이 해킹을 시도하기 전에 애플리케이션에 대한 깊은 이해를 구축한 것임을 앞에서 설명 했다.
또한 우리는 정찰이 해커의 도구 가운데 중요한 부분임을 알고 있다.

그러나 지금까지 정찰에 대해 우리가 알고 있는 지식은 여기까지다.
정찰이 중요한 이유를 기술적인 관점에서 알아보자

:::warning 
- 3장 부터 소개하는 여러가지 정찰 기법은 애플리케이션을 매핑하는데 유용하지만 여러분의 ip가 식별되어 애플리케이션 사용이 금지되거나 법적 문제를 초래 할 수 있다.
- 정찰 기법 대부분은 자신의 소유 또는 서면으로 허가 얻은 애플리케이션에 대해서만 수행해야한다.

:::

정찰은 여러 가지 방법으로 수행 가능하다.

공개된 애플리케이션 대부분에는 공개된 사용자 인터페이스가 존재한다.
그러나 이러한 경우에도 전체 사용자 인터페이스에 접근할 수 있다고 생각해서는 안된다.
사용자 인터페이스의 일부에 대해서만 액세스 할 수 있다고 생각하는 것이 옳다.

:::note 역할 기반 액세스 제어(role - base access control)
전체 사용자에 대해 동일 수준의 permission을 부여하지 않고, 역할에 따라 다른 permission을 주는 기술

:::

이러한 액세스 제어 기능이 있는 소프트웨어는 많이 사용해보고 있다.
OS 명령어 중 위험한 것은 관리자 자격 증명을 요구한다.
또 다른 예로 소셜 미디어 웹 사이트는 일반 사용자 보다 더 높은 permission을 갖되 관리자보다는 낮은 permission을 갖는 조정자 권한을 두는 곳이 많다.

웹 애플리케이션의 사용자 인터페이스를 사용하다 보면 이와 같이 승격된 permission을 갖는 사용자를 위해 API 엔드포인트를 절대 찾을 수 없을 것이다.

하지만 웹 애플리케이션 정찰에 숙달하면 이러한 API를 찾을 수 있게 된다.

심지어 관리자나 조정자의 완전한 permission을 상세하게 나타내는 복잡한 맴을 만들고 이를 일반 사용자의 permission과 비교할 수도 있다.
때로는 권한이 있는 사용자 전용으로 의도된 기능을 권한 없는 사용자가 악용하는 허점을 찾아내기도 한다.

액세스를 갖지 않은 애플리케이션에 대한 정보를 수집하는데 정찰 기술을 사용할 수 있다.

이는 학교 내부망이라든지 회사 네트워크에서만 액세스 가능한 파일 서버가 될 수 있다.
애플리케이션의 API 구조를 역공학으로 알아내고 이러한 API가 수용하는 페이로드를 작성하는 기술을 갖고 있다면, 사용자 인터페이스 없이도 애플리케이션이 어떻게 작동하는지 알아 낼 수 있다.

때로는 무방비 상태의 서버나 API에 대한 정찰을 수행하다가 침투까지 성공할 수도 잇다.
많은 회사는 안팎으로 다수의 서버를 운영한다.

네트워크 회선이나 방화벽 구성 중 하나라도 잘 못 구성하면 HTTP 서버가 제한적인 내부 망이 아닌 공중 망에 노출되어 버릴 수도 있다.
웹 애플리케이션 기술과 아키텍쳐의 맵을 그려가다 보면 공격의 우선순위를 더 잘 정할 수 있게 된다.
앱의 어느 부분이 가장 안전한지 이해하면 가장 약한 고리도 찾을 수 있다.

## 웹 애플리케이션 매핑
일반적으로 웹 애플리케이션에 대해 해킹을 시도하기 전에 정차를 먼저 수행해야 함을 명심하자
웹 애플리케이션 정찰에 능숙해짐에 따라 찾아낸 정보를 기록하고, 조직화하는 자기 만의 방법을 개발하게 될 것이다.

지형적인 포인트를 조직화한 컬렉션을 맴이라고 한다.
지형학에서는 땅의 특징, 형태, 표면을 연구한다.

웹 애플리케이션도 특징, 형태, 표현이 잇다.
자연에서 찾을 수는 없지만, 개념은 유사하다. 코드, 네트워크 구조, 애플리케이션의 기능 집합과 관련된 데이터 포인트를 정의하는 용어로 맵을 사용한다.

맵을 그리는데 필요한 데이터를 획득하는 법을 배우게 될 것이다.

테스트할 애플리케이션의 복잡도와 테스트 기간에 따라 맵을 간단히 노트에 기록하는 것으로 충분할 수도 있다.
견고한 애플리케이션이나 장기간에 걸쳐 자주 테스트할 애플리케이션에 대해서는 좀 더 견고한 솔루션이 필요할 수도 있다.

관련성이 있는 정보와 관계를 쉽게 저장하고 되살릴 수 있다면, 어떤 형식도 괜찮다

개인적으로 JSON 과 비슷한 형식으로 기록하는 것을 선호한다.
웹 애플리케이션에 빈번하게 나타나는 계층적 구조를 저장하고, 정렬과 탐색도 쉽게 할 수 있기 때문이다.

다음은 어떤 웹 애플리케이션의 API 서버에서 발견한 API 엔드포인트를 JSON과 유사한 형식으로 기록한 정찰 노트이다.

```json
{
	api_endpoints:{
		sign_up:{
			url: 'mywebsite.com/auth/sign_up',
			method: 'POST',
			shape:{
				username: { type: String, required: true, min: 6, max: 18 },
				password: { type: String, required: true, min: 6, max: 32 },
				referralCode: { type: String, required: true, min: 64, max: 64 }
			},
		},
		sign_in:{
			url: 'mywebsite.com/auth/sign_in',
			method: 'POST',
			shape:{
				username: { type: String, required: true, min: 6, max: 18 },
				password: { type: String, required: true, min: 6, max: 32 }
			}
		},
		reset_password:{
			url: 'mywebsite.com/auth/reset',
			method: 'POST',
			shape:{
				username: { type: String, required: true, min: 6, max: 18 },
				password: { type: String, required: true, min 6, max: 32 },
				newPassword: { type: String, required: true, min: 6, max: 32 }
			}
		}
	},
	features:{
		comments: {},
		uploads:{
			file_sharing: { }
		},
	},
	integrations:{
		oath:{
			twitter: { },
			facebook: { },
			youtube: { },
		}
	}
}
```

기록할 정보가 많아지더 라라도 확장할 수 있는 방법을 찾아야 한다.


정찰 기법은 웹 애플리케이션, 사용하는 서비스의 기술과 구조에 대한 깊은 이해를 얻는데 가치가 있다.
웹 애플리케이션에 대한 정찰을 수행하는 능력을 키우는 것과 더불어 찾아낸 것을 주의 깊게 살피고, 
나중에 쉽게 이용할 수 있게 조직화 된 문서를 작성해야 한다.

앞에서 웹 애플리케이션에 대한 정찰 결과를 문서화할 때 선호하는 JSON과 비슷한 노트의 예시를 소개했다.
정찰 노트를 기록할 때 가장 중요한 것은 읽기 쉽고 수작업으로 순회하기 쉬우면서도 관계와 계층을 보존하는 것이다.






