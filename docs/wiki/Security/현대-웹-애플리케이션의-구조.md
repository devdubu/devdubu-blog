---
slug: "현대-웹-애플리케이션의-구조"
---
정찰 목적으로 웹 애플리케이션을 효과적으로 평가하려면, 많은 웹 애플리케이션이 공통적으로 의존하는 기술을 이해하는 것이 최선입니다.

이러한 의존성은 JS helper 라이브러리, 미리 정의된 CSS 모듈, 웹 서버와 운영체제까지 걸쳐있으며, 그 역할과 애플리케이션 스택에서 공통적인 구현을 이해함으로써 좀 더 쉽게 식별하고 구성 오류를 찾아낼 수 있다.

# 전통 웹 애플리케이션과 현대 웹 애플리케이션 비교
지금의 웹 애플리케이션은 10년 전만 해도 존재하지 않던 여러 기술에 의존한다.
웹 애플리케이션을 구축하는 데 사용하는 도구들이 너무 많이 발전해서, 과거와 완전히 다른 전문 분야가 되어 버린 것 처럼 보인다.

10년 전으로 거슬러 올라가면 대다수의 웹 애플리케이션은 렌더링할 HTML/JS/CSS 페이지를 클라이언트에 송신하는 서버 측 프레임워크를 사용해 구축했다.
업데이트가 필요하면, 클라이언트는 단순히 또 다른 페이지를 서버에 요청해 HTTP를 통해 받아서 렌더링 했다.

그로부터 얼마 지나지 않아 JS를 사용해 페이지 세션 내에서 네트워크 요청을 할 수 있는 Ajax가 등장하면서, 웹 애플리케이션은 HTTP를 이전 보다 더 자주 사용하기 시작했다.

현대 애플리케이션은 단일 모놀리식 애플리케이션보다는 둘 이상의 애플리케이션이 네트워크 프로토콜을 통해 통신하는 형태가 많아졌다.
이것이 10년 전과 현재의 웹 애플리케이션 사이의 주요한 아키텍처 상의 차이점이다.
지금의 웹 애플리케이션은 표현 상태 전송 REST API를 통해 연결되는 여러 애플리케이션으로 이뤄지는 경우가 많다.
이러한 API 는 상태를 저장하지 않으며, 다른 애플리케이션으로부터의 요청을 처리하기 위해 존재할 뿐이다.

이는 요청자에 대한 어떠한 정보도 저장하지 않음을 뜻한다.

현재 브라우저에서 실행되는 클라이언트 UI 애플리케이션의 상당수는 전통적인 데스크톱 애플리케이션과 닮았다.
이 클라이언트 애플리케이션들을 자체적인 수명 주기 순환을 관리하고 자체 데이터를 요청하며, 초기 부트스트랩 완료 후 페이지 리로드를 필요로 하지 않는다.

독립 실행형 애플리케이션을 웹 브라우저에 배치해 여러 대의 서버와 통신하는 것도 드물지 않다.
사용자 로그인을 허락하는 이미지 호스팅 애플리케이션을 생각해보자.
한 URL에는 hosting/deploy 를 담당하는 서버가 있을 것이고, 데이터 베이스와 로그인을 관리하는 별도의 URL도 있을 것이다.

오늘날의 애플리케이션들은 독립적이면서도 유기적으로 작동하는 많은 애플리케이션들의 조합이라고 표현하더라도 과언이 아니다.
이것이 가능해진 것은 깔끔하게 정의된 네트워크 프로로콜 API 아키텍처 패턴에 힘입은 덕분이다.

현대 웹 애플리케이션은 다음의 여러 기술을 사용한다.
- REST API
- JSON or XML
- JS
- SPA( react, vue ...)
- 인증 및 권한 부여 시스템
- 하나 이상의 웹 서버
- 한 가지 이상의 웹 서버 소프트웨어 패키지(Nginx, tomcat)
- 한 가지 이상의 데이터 베이스(MySQL, Mongo DB 등 )
- 클라이언트의 로컬 데이터 스토어( 쿠키, 웹 스토리지, 인덱스트 DB)
나온지 몇 년 지난 기술도 있지만, 그때와 지금은 만힝 달라졌을 가능성이 높다.
데이터베이스는 수십 년 전부터 사용되었지만, NoSQL 데이터베이스와 클라이언트 측 데이터베이스는 최근에 개발 되었다.
NodeJS와 npm 이 급속도로 확산되기 전에는 풀스택 JS 애플리케이션의 개발이 불가능 했다.
웹 애플리케이션의 지형은 지난 10년 간 매우 빠르게 변화 했으며, 거의 알려지지 않았던 많은 기술이 보편화 됐다.

로컬에 요청을 저장하는 cash API, 클라이언트 - 서버 또는 통신을 위한 대안 네트워크 프로토콜인 웹 소켓과 같은 여러 가지 최신 기술도 잇다.
마침내 브라우저에서 웹 어셈블리 라는 일종의 어셈블리 코드를 완전하게 지원해 클라이언트 측 코드를 작성하는데 JS 이외의 언어를 사용할 수 있게 하려고 한다.

이러한 새로운 기술들은 새로운 보안의 결함을 수반한다.
따라서 좋은 의도에서든 그렇지 않든 그것을 찾고 익스프로잇 하게 된다.
웹 애플리케이션의 익스플로잇 또는 보안과 관련된 사업에 있어서는 신나는 일이다

# REST API

:::tip API를 정의하는 훌륭한 방법인 REST는 다음과 같은 특징을 가진다.

:::

:::note 클라이언트와 독립적이어야 한다.

:::

REST API는 고도의 확장성을 가지면서도 단순한 웹 애플리케이션을 구축하도록 설계 됐다.
클라이언트를 API와 분리하되 엄격한 API 구조를 따름으로써 클라이언트 애플리케이션이 데이터 베이스를 호출하거나 서버 측 로직 자체를 수행하는 일 없이 쉽게 리소스를 요청할 수 있다.

:::note 상태를 저장하지 않는다.

:::

REST API는 입력을 받아 출력을 제공하기만 한다.
API는 클라이언트 연결과 관련해 어떠한 상태도 저장해서는 안 된다.
그렇지만, REST API가 인증과 권한 부여를 수행하지 못하는 것은 아니다.
권한 부여는 토큰화되어 요청할 때마다 전송된다.

:::note 쉽게 캐시할 수 있어야한다.

:::

인터넷에서 웹 애플리케이션을 적절히 확장하기 위해 REST API는 반드시 캐시 가능 여부를 쉽게 표시할 수 있어야한다.
REST는 어느 엔드포인트가 어떤 데이터를 제공할 것인지에 대해 매우 엄격하게 정의 하므로 적절하게 설계된 REST API에서 이것을 아주 쉽게 구성할 수 있다.
권한이 있는 정보가 다른 사용자에게 실수로 누설되는 것을 방지하기 위해 프로그래밍으로 캐시를 관리하는 것이 이상적이다.

:::note 엔드포인트는 특정 객체나 메서드를 정의해야 한다.

:::

엔드포인트는 보통 계층적으로 정의 된다. ex) `/moderators/joe/12_21_2018`
이렇게 함으로써 REST API는 GET, POST,PUT, DELETE 같은 HTTP 동사를 쉽게 만들 수 있다.
그 결과로 하나의 엔드포인트가 HTTP 동시를 여러 개 가질 수 있다.

과거에는 대부분의 웹 애플리케이션이 단순 객체 액세스 프로토콜(SOAP) 구조의 API를 사용했다.
SOAP 와 비교한 REST의 장점은 다음과 같다.

- 기능이 아니라 대상 데이터를 요청한다.
- 요청을 캐시하기 쉽다.
- 확장성이 높다.

SOAP API는 전송 데이터 포맷으로 반드시 XML을 사용해야 하지만, REST API는 어떤 데이터 포맷이든 사용 할 수 있다.
가볍고 사람이 읽기도 쉬운 JSON이 주로 사용되며, 이는 REST가 경쟁에서 우위에 서는 데 유리하게 작용했다.

여러분이 침투 대상으로 삼는 현대 웹 애플리케이션 대부분 REST API를 사용하거나 그와 비슷하게 JSON을 제공할 것이다.
레거시 호환을 위해 기능을 유지하는 특정 엔터프라이즈 앱을 제외하면 SOAP  API와 XML을 접하는 경우는 점점 드물어지고 있다.

웹 애플리케이션의 API 계층에 대한 역공학을 시도하는 입장에서는 REST API의 구조를 이해 하는 것이 중요하다.
API를 조사하다 보면 REST 아키텍처를 따르는 것을 많이 접하게 되므로, REST API의 기초를 익히면 좋다.
또한 우리가 직접 사용하거나 작업 흐름을 통합하는 여러 도구도 REST API를 통해 노출된다.

## JSON
REST는 HTTP 동사를 서버의 리소스에 어떻게 매핑해야 하는지 정의하는 아키텍쳐 사양이다.
오늘 날의 REST API는 대부분 JSON을 전송 데이터 포맷을 사용한다.

애플리케이션의 API 서버는 반드시 클라이언트와 통신 해야 한다는 점을 고려하자.
클라이언트 / 서버 관계가 없이는 디바이스들을 걸쳐 상태를 저장하고 그 상태를 계정 사이에 지속 시킬 수 없다.

모든 상태는 로컬에 저장되어야 한다.

현대 웹 애플리케이션이 클라이언트/서버 통신을 많이 요구하므로(다운 스트림으로는 데이터 교환이, 업 스트림으로는 HTTP 동사 형식의 요청이 일어난다.)
데이터를 아무 포맷으로 보낼 수는 없다.
전송 데이터 포맷의 표준화가 필요하다.

JSON이 이 문제의 해결책이 될 수 잇다.
JSON은 여러가지 흥미로운 욕사항을 충족하는 공개 표준 파일 포맷이다.
:::note 
- 경량이다.
- 네트워크 대역폭을 절약
- 파싱하기가 아주 쉽다.
- 서버/클라이언트 하드웨어 부하 경감
- 사람이 쉽게 읽을 수 있다.
- JSON 객체는 JS 객체와 매우 유사하게 표현되어 브라우저에서 JSON의 소비와 새로운 JSON 객체의 생성이 쉽다.

:::

위와 같은 특징 외에도 지금의 주요 브라우저는 모두 JSON의 파싱을 자체적으로 지원하고 빠르다는 점에서 JSON은 상태 비저장 서버와 웹 브라우저 사이의 데이터 전송에 아주 적합한 포맷이다.

```json
{
	first : "Sam",
	last: "Adams",
	email: "sam.adams@company.com",
	role: "Engineering Manager",
	company: "TechCo.",
	location: {
		country: "USA",
		state: "california",
		address: "123 main st.",
		zip: 98404
	}
}
```
이것을 브라우저에서 JS 객체로 쉽게 파싱이 가하다.

```js
const jsonObject = JSON.parse(jsonString)
```
JSON은 유연하고 가벼우며 사용하기 쉽다.
하지만 경량 포맷이 갖는 단점에서는 자유롭지 못하다.

오늘날의 브라우저와 서버 사이의 네트워크 요청의 상당량이 JSON으로 전송된다는 사실이다.
JSON 문자열에 익숙해지도록 노력하고, JSON 형식의 문자열을 다룰 수 있는 브라우저 플러그인이나 코드 편집기를 사용하는 것을 고려하라.
JSON을 빠르게 분석해 특정 키를 찾는 능력은 제한된 시간 내에 다양한 API를 테스트 해야하는 침투 테스터에게 매우 귀중하다.












