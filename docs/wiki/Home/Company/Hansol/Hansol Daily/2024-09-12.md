---
sticker: emoji//1f4c6
종료 날짜: 2024-09-12
시작 날짜: 2024-09-12
분류: 노트
카테고리:
  - Application
특징:
  - Front
  - Nuxt3
---
# 동적 select box

chained select 는 `styleCallback` / `displayCallback` 로 가능함

현재의 구조에서는 문제는 list의 데이터가 `[]` 일 때는 가능함

하지만, `async await` 구문을 이용하게 된다면, `promise` 리턴 하게 되는데 이 부분에서 부터 문제가 발생함

현재 구조에서는 해결 할 방법이 없음

## 현 구조

```tsx
const columnStyleCallBackFunc = async (grid: any, dataCell: any) => {
    const selectNation = grid.getValue(dataCell.index.itemIndex, 'GCD')
    const ret: any = {}

    if (selectNation === 'Korea') {
        const apiInfo = {
            url: '/api/admin/code/code-grp',
        }
        const _params = {}
        const resultData = await hdata.callRemoteApi(apiInfo, _params)

        await resultData.forEach((select: any, index: any) => {
            selectLabels[index] = select['CODE_GRP_NM']
            selectValues[index] = select['CODE_GRP_CD']
        })
        // selectLabels = ['독일어', '스페인어']
        // selectValues = ['ge_GE', 'sp_SP']
    } else {
        selectLabels = ['English', '한국어']
        selectValues = ['en_US', 'ko_KR']
    }

    ret.editor = {
        type: 'dropdown',
        dropDownCount: 4,
        domainOnly: true,
        textReadOnly: true,
        values: selectValues,
        labels: selectLabels,
    }

    console.log(ret.editor)
    return ret
}

const columnDisplayCallBackFunc = async (grid: any, index: any, value: any) => {
    const selectNation = grid.getValue(index.itemIndex, 'GCD')
    let retValue = value

    if (selectNation !== 'Korea') {
        selectLabels = ['English', '한국어']
        selectValues = ['en_US', 'ko_KR']
    } else {
        const apiInfo = {
            url: '/api/admin/code/code-grp',
        }
        const _params = {}
        const resultData = await hdata.callRemoteApi(apiInfo, _params)

        await resultData.forEach((select: any, index: any) => {
            selectLabels[index] = select['CODE_GRP_NM']
            selectValues[index] = select['CODE_GRP_CD']
        })
        // selectLabels = ['독일어', '스페인어']
        // selectValues = ['ge_GE', 'sp_SP']
    }
    const idx = selectValues.indexOf(value)
    retValue = selectLabels[idx]

    console.log(index)
    return retValue
}

const column = [
	{
        name: 'LANG',
        fieldName: 'LANG',
        width: 150,
        sortable: true,
        editable: true,
        values: ['en_US', 'ko_KR'],
        labels: ['English', '한국어'],
        editor: {
            type: 'dropdown',
            dropDownCount: 4,
            domainOnly: true,
            textReadOnly: true,
        },
        header: {
            text: '공통 코드 Select',
            styleName: 'orange-column',
        },
        styleCallback: columnStyleCallBackFunc, // 객체는 await을 지원하지 않음
        displayCallback: columnDisplayCallBackFunc, // 객체는 await을 지원하지 않음
    },
	
]
```

- 즉, 위의 구조는 가능하지 않다.
- 결국은 `selectValues` 와 `selectLabels` 가 매개변수 혹은 어떤 형식 으로든 이미 생성이 되어있는 배열 이어야 한다.

결론적으로는 `columnStyleCallBackFunc` / `columnDisplayCallBackFunc` 은 return 값이 `Promise<T>` 면 안된다.

해결 방안,,,,은 아래와 같다

```tsx
export const setDynamicSelectBox = async()=>{
	// API 관련 로직들
	
	const columnStyleCallBackFunc = ()=>{ }
	const columnDisplayCallBackFunc = ()=>{ }
	
	return { columnStyleCallBackFunc, columnDisplayCallBackFunc }

}
```

그 후에, selectBox API 가 사용한 곳에서

```tsx
 const dynamicSelectBoxTest = await setDynamicSelectBox()
 
 return {
	  styleCallback: dynamicSelectBoxTest.columnStyleCallBackFunc,
    displayCallback: dynamicSelectBoxTest.columnDisplayCallBackFunc,
 }
 
```

위처럼 시전하니 성공쓰…

문제는 이를 어떻게 configuration으로 뺄 것인지에 대한 의문

### 조건 분리 해서 생각해보기

1. 우선 “특정 Field” 에서 나
2. 특정 값이 체크 된다면, api 혹은 작성한 data를 이용해서 selectbox의 데이터를 교체 해야 함

만약 아래와 같은 `func` 이 온다면?

```tsx
const dynamicSelect = async (grid:any) => {
	const value = grid.getValue(dataCell.index.itemIndex, 'Field 명')
	
	if(value === '특정 값'){
		//특정 api 데이터 return 값
		// config js 파일에서도 func={ } 함수를 이용해서 api 호출 가능
		const test = await hdata.post('/api/admin/code/code-grp', {}, { quiet: false })
	}else if(value === '특정 값1'){
		//특정 api 데이터 return 값
	}
	
}
```

조건 절 따로, url 경로 (또는 data Array)는 각각 받아야 함

func 으로 정형화는 불가능에 가까움 - 위 처럼 조건 절 + api 를 통한 데이터 리턴은 어려움

### 방법1

- func는 조건 절로 return 값을 boolean으로 만 받음
    
- api는 따로 url을 받던, 혹은 그냥 데이터를 받던 해야 함
    
- 그리고 이 둘의 관계를 mapping 시켜야 할 부분이 존재 해야 하며, 여러 개의 조건과 여러 개의 각기 다른 값들이 온다는 것을 가정 해야 함