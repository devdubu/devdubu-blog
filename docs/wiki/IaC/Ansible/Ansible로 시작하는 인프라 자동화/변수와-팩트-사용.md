---
slug: "변수와-팩트-사용"
---
동일한 코드 구문에 입력되는 값에 따라 동작은 변경하여 반복적인 사용이 가능하도록 설계 하기 위해, 앤서블 플레이북에서도 변수를 정의하고 사용할 수 있습니다.

변수를 어디에 정의하느냐에 따라 그룹 변수가 될 수도, 호스트 변수가 될 수도, 플레이 변수가 될 수도 있습니다.
변수에는 일반적인 내용을 저장하는 일반 변수와 패스워드 같이 암호화가 필요한 정보들을 저장하는 변수가 있습니다.

# 변수의 종류와 사용법
앤서블은 변수를 사용하여, 사용자, 설치하고자 하는 패키지, 재시작할 서비스, 생성 또는 삭제 할 파일명 등 시스템 작업 시 사용되는 다양한 값을 저장할 수 있습니다.

앤서벌에서 사용되는 변수는 그룹 변수, 호스트 변수, 플레이 변수, 추가 변수가 있으며 플레이 결과를 저장하기 위한 작업 변수도 있습니다.

그럼 지금 부터 각각의 변수에 대해 알아보겠습니다.

## 그룹 변수
그룹 변수는 인벤토리에 정의된 호스트 그룹에 적용하는 변수를 의미합니다.

따라서 인벤토리에 선언해야 하고, 선언하고자 하는 그룹명과 함께 `:vars` 라는 문자열을 추가해 변수를 선언한다는 것을 알려줍니다.
예제를 통해 알아보겠습니다.

1. `ansible-server`와 `my-ansible` 디렉터리에 잇는 `inventory` vkdlf gkeksep `[all:vars]` 섹션을 선언하고, 해당 섹션 아래에 `user=ansible` 이라는 변수와 값을 선언합니다. 이렇게 하면 all 이라는 그룹에서 user라는 변수를 사용할 수 있습니다.

다음 예제에서는 all 그룹에는 web 그룹과 db 그룹이 , web 그룹에는 `tnode1-centos.exp.com`, `tnode2-ubuntu.exp.com` 이 포함되며, db 그룹에는 tnode3-rhel.exp.com 이라는 호스트가 포함됩니다.
```shell
vi inventory
[web]
tnode1-centos.exp.com
tnode2-ubuntu.exp.com

[db]
tnode3-rhel.exp.com

[all: vars]
user-ansible
```

2. 이번에는 `create-user.yml` 이라는 파일을 생성합니다. 해당 파일은 사용자를 생성하는 태스크를 포함합니다. 
앤서블에서는 시스템 사용자(`account`) 를 생성하기 위해서는 `ansible.builtin.user` 라는 모듈을 사용합니다. 그리고 인벤토리에서 선언한 user 라는 변수를 겹중 괄호 사이에 넣어주면, 해당 변수를 플레이북에서 사용할 수 있습니다.

이 때 겹 중괄호와 변수 명 사이에 넣어주면, 해당 변수를 플레이북에서 사용할 수 있습니다.
이때 겹 중괄호와 변수면 사이는 항상 한칸씩 띄워야합니다.

```yaml
- hosts: all
- tasks:
	- name: Create User {{ user }}
	- ansible.builtin.user:
		- name : " {{ user }}"
		- state: present
```

3. 앞에서 생성한 플레이북을 `ansible-playbook` 명령어와 함께 실행합니다.
	- 그러면 태스트명으로 `Create User {{ user }}` 라고 변수를 사용한 부분에 해당 변수의 값인 ansible이라는 문자열이 보이는 것을 확인 할 수 있습니다.
```shell
ansible-playbook create-user.yml
```

4. 실제 대상 호스트에 접근하여 ansible 이라는 사용자가 생성되었는지 확인합니다.
	- 시슽ㅁ에서 사용자를 생성하면 `/home` 디렉터리 아래에 해당 사용자명으로 디렉터리가 생성됩니다.
	- 따라서 `/home` 디렉터리를 먼저 확인하면 그 안에서 ansible 이라는 사용자를 확인 할수 있습니다.
```shell
ll /home
```

### Host 변수
이번에는 host 변수를 선언하고 사용하겟습니다
호스트 변수는 말 그래도 변수를 해당 호스트에서만 사용할 수 있습니다.
1. 인벤토리 파일을 열고 db 그룹의 `tnode3-rhel.com` 호스트 옆에 `user=ansible1`이라는 변수를 선언합니다.
```shell
vi inventory


[web]
tnode1-centos.exp.com
tnode2-ubuntu.exp.com

[db]
tnode3-rhel.exp.com user=ansible

[all:childern]
web
db

[all:vars]
user=ansible

```
2. 앞에서 생성한 `create.yml` 파일을 `create-user1.yml` 파일로 복사한 다음 vi 에디터로 `create-user1.yml` 파일을 열어 다음과 같이 `hosts` 를 all 에서 db로 수정합니다.
```shell
cp create-user.yml create-user1.yml
vi create-user1.yml
```

```yaml
- hosts: db
- tasks:
	- name: Create User {{ user }}
	- ansible.builtin.user:
		- name: "{{ User }}"
		- steate: present
```

3. 플레이북 작성을 완료하고 `ansible-playbook` 명령어를 이용하여, `craete-user1.yml` 파일을 실행합니다.
	- 이때 `user` 명은 인벤토리 `[all:vars]` 섹션에 선언된 ansible 이 아니라, db 그룹의 `tnode3-rhel.exp.com` 호스트 옆에 선언한 `ansible1` 을 사용한 것을 확인 할 수 있습니다.
	- 이를 통해 호스트 변수는 그룹 변수에 비해 우선순위가 높다는 것을 알 수 있습니다.


---

#IaC #Ansible 