---
slug: "MemoryDB-for-Redis"
---
MemoryDB for Redis에 대한 내용과 사용 방법에 대한 기술 문서 입니다.

# MemoryDB for Redis

Redis용 MemoryDB는 매우 빠른 성능을 제공하는 내구성이 뛰어난 인메모리 데이터베이스 서비스 입니다.

MemoryDB는 널리 사용되는 오픈 소스 데이터 저장소인 Redis 와 호환되므로 현재 사용하고 있는 것과 동일한 유연하고 친숙한 Redis 데이터 구조, API 및 명령을 사용하여 애플리케이션을 빠르게 구축할 수 있습니다.

## MemoryDB의 기능

Redis용 MemoryDB는 매우 빠른 성능을 제공하는 내구성이 뛰어난 인메모리 데이터 서비스 입니다.
- 기본 노드에 대한 **강력한 일관성** 및 **복제본 노드**에 대한 **최종 일관성**을 보장합니다.
- 클러스터 당 **최대 1억 6천만 TPS**의 마이크로초 읽기 및 1자리 밀리 초 쓰기 지연 시간
- 유연하고 **친숙한 Redis 데이터 구조** 및 **API**.
    - 거의 수정 없이 새로운 애플리케이션을 손쉽게 구축하거나 기존 Redis 애플리케이션을 마이그레이션할 수 있습니다.  
- **빠른 데이터베이스 복**구 및 **재시작**을 제공하는 **다중 AZ 트랜잭션 로그**를 사용한 **데이터 내구성**.

![Pasted-image-20250410101315.png](/img/이미지 창고/Pasted-image-20250410101315.png)
- **자동 장애 조치**, **노드 장애 감지** 및 **복구**가 가능한 **다중 AZ 가용성**
- 노드를 추가 및 제거하여 수평으로 쉽게 확장하거나 더 크거나 작은 노드 유형으로 이동하여 수직으로 확장할 수 있습니다.
    - 샤드를 추가하여 쓰기 처리량을 확장하고 복제본을 추가하여 읽기 처리량을 확장할 수 있습니다.
- **Read-after-write** 기본 노드에 대한 일관성 및 **복제본 노드**에 대한 **최종 일관성**을 **보장**합니다.
- MemoryDB는 **전송 중 암호화**, **저장 중 암호화** 및 **사용자 인증**을 **지원**합니다.

![Pasted-image-20250410101325.png](/img/이미지 창고/Pasted-image-20250410101325.png)

- Amazon S3 자동 **스냅샷은 최대 35일** 동안 보존됩니다.
- 클러스터당 최대 500개의 노드와 100TB 이상의 스토리지 Support (샤드당 1개의 복제본 포함).
- **TLS를 통한 전송 중 암호화** 및 저장 중인 **암호화 AWS KMS키**.
- Redis를 통한 사용자 인증 및 권한 부여
- 다른 제품과의 통합 AWS 다음과 같은 서비스 **CloudWatch,** **Amazon VPC, CloudTrail** 모니터링, 보안 및 알림을 위한 **Amazon SNS**
- 완전 관리형 소프트웨어 패치 및 업그레이드
- AWS관리 API에 대한 Identity and Access Management (IAM) 통합 및 태그 기반 액세스 제어

## MemoryDB 코어 컴포넌트

- 클러스터는 **단일 데이터 세트**를 제공하는 **하나 이상의 노드 모음**입니다.
- MemoryDB 데이터 세트는 샤드로 분할되며, 각 샤드에는 기본 노드와 최대 5개의 선택적 복제본 노드가 있습니다.
- 기본 노드는 **읽기** 및 **쓰기 요청**을 **처리**하고 **복제 본은 읽기 요청**만 **처리**합니다.
- MemoryDB는 Redis를 데이터베이스 엔진으로 실행하고 클러스터를 만들 때 클러스터에 대한 Redis 버전을 지정합니다.
    - 다음을 사용하여 **클러스터**를 **생성**하고 **수정**할 수 있습니다.
        - AWS CLI, 메모리DB API 또는 AWS Management Console
    - 각 MemoryDB 클러스터는 Redis 엔진 버전을 실행합니다.
- 각 Redis 엔진 버전에는 지원되는 고유한 기능이 있습니다.
    - 또한 Redis 엔진 버전마다 관리하는 클러스터의 동작을 제어하는 파라미터 그룹에 파라미터 집합이 있습니다.
- **클러스터의 계산** 및 **메모리 용량**은 해당 **노드 유형**에 의해 **결정**됩니다.
- 사용자의 요구 사항에 가장 잘 맞는 노드 유형을 선택할 수 있습니다.

## 노드

![Pasted-image-20250410101350.png](/img/이미지 창고/Pasted-image-20250410101350.png)

- MemoryDB 배포의 가장 **작은 빌딩 블록**이며 **Amazon EC2** 인스턴스를 **사용 해 실행** 됩니다.
- 각 노드는 **클러스터**를 **생성할 때** 선택한 **Redis 버전**을 **실행**합니다.
- 노드는 클러스터에 속하는 샤드에 속합니다.
- 각 노드는 클러스터를 생성할 때 선택한 버전에서 엔진 인스턴스를 실행합니다.
- 필요한 경우 클러스터의 노드를 다른 유형으로 스케일 업 하거나 스케일 다운할 수 있습니다.

## 샤드

- **샤드는 1~6개의 노드**로 구성된 그룹이며, **하나는 기본 쓰기 노드**로, **나머지 5개는 읽기 전용 복제본**으로 사용됩니다.
- MemoryDB 클러스터에는 **항상 하나 이상의 샤드**가 있습니다.
- **MemoryDB 클러스터**는 **최대 500개의 샤드**를 가질 수 있으며, 데이터는 샤드를 통해 분할됩니다.
    - 예를 들어 83개 샤드(샤드당 기본 1개와 복제본 5개)에서 500개 샤드(기본 1개와 복제본 없음) 범위의 500개 노드 클러스터를 구성하도록 선택할 수 있습니다.
- 증가를 수용할 수 있는 **IP 주소**가 **충분**한지 **확인**해야 합니다.
- 서브넷 그룹에 있는 서브넷의 **CIDR 범위**가 너무 작거나 서브넷을 **샤드로 분할**하여 다른 클러스터에서 과도하게 사용되는 것과 같은 **일반적인 함정**에 유의합니다.
- 다중 노드 샤드는 읽기/쓰기 기본 노드 하나와 1~5개의 복제본 노드를 통해 복제를 구현합니다.


## 파라미터 그룹 수

- 파라미터 그룹은 클러스터에서 Redis에 대한 **런타임 설정**을 **관리**하는 **쉬운 방법**입니다.
- 메모리 사용량, 항목 크기 등을 제어하는 데 파라미터가 사용됩니다.
- MemoryDB 파라미터 그룹은 클러스터에 적용할 수 있는 엔진 별 파라미터의 이름이 지정된 모음이며, 해당 클러스터의 모든 노드는 정확히 동일한 방식으로 구성됩니다.

# MemoryDB for Redis 생성

## 클러스터 생성

- 프로덕션 용도로 사용할 클러스터를 생성하기 전에 비즈니스 요구 사항에 맞게 클러스터를 구성할 방법을 고려해야 합니다.
- 생성하려는 클러스터는 활성화되고 샌드박스에서 실행되지 않습니다. 삭제하기 전까지는 인스턴스에 대한 표준 MemoryDB 사용 요금이 부과됩니다.

## 메모리DB 클러스터 생성

- MemoryDB 콘솔을 사용하여 클러스터를 만들려면

![Pasted-image-20250410101423.png](/img/이미지 창고/Pasted-image-20250410101423.png)

- Amazon MemoryDB 시작하기를 누릅니다.
- **VPC 설정이 이미 완료**가 됐다면, 아래 **클러스터 생성**을 누릅니다.

![Pasted-image-20250410101433.png](/img/이미지 창고/Pasted-image-20250410101433.png)

- 클러스터 생성을 누릅니다.
    

![Pasted-image-20250410101439.png](/img/이미지 창고/Pasted-image-20250410101439.png)

- 현재 상황에 맞게 해당 설정 정보들을 작성합니다.
- 연결 할 **서브넷**을 선택합니다. (현 그림에서는 Subnet을 지정하지 않았습니다)

![Pasted-image-20250410101450.png](/img/이미지 창고/Pasted-image-20250410101450.png)

- 만약 선택 가능한 Subnet이 없다면 아래와 같이 **새로운 Subnet**에서 **선택도** 가능합니다.


![Pasted-image-20250410101457.png](/img/이미지 창고/Pasted-image-20250410101457.png)

- 서브넷 그룹의 경우 새 서브넷 그룹을 만들거나 사용 가능한 목록에서 이 클러스터에 적용할 기존 서브넷 그룹을 선택합니다. 새 계정을 만드는 경우:
    - 이름 입력
    - 설명 입력
    - **다중 AZ를 활성화한 경우** 서브넷 그룹에는 서로 **다른 가용 영역**에 상주하는 **서브넷이 두 개 이상** 있어야 합니다.


![Pasted-image-20250410101512.png](/img/이미지 창고/Pasted-image-20250410101512.png)

- 위 화면을 보게 된다면, Redis에 대한 생성을 완료한 것입니다.

## 클러스터에 대한 액세스 권한 부여

- 메모리DB 클러스터는 **Amazon EC2 인스턴스**에서 **액세스**할 수 있도록 설계되었습니다.
- 또한 **Amazon Elastic Container Service**에서 실행되는 **컨테이너식** 또는 **서버리스 애플리케이션**을 통해서도 액세스할 수 있습니다.
- EC2 인스턴스에서 클러스터에 연결하려면 EC2 인스턴스가 클러스터에 액세스하도록 권한을 부여해야 합니다.

![Pasted-image-20250410101522.png](/img/이미지 창고/Pasted-image-20250410101522.png)

- 가장 일반적인 사용 사례는 **EC2 인스턴스**에 배포된 애플리케이션이 같은 **VPC에 있는 클러스터**에 **연결**해야 하는 경우입니다.


![Pasted-image-20250410101529.png](/img/이미지 창고/Pasted-image-20250410101529.png)

- **동일한 VPC**에서 **EC2 인스턴스**와 클러스터 간 액세스를 **관리**하는 **가장 간단한 방법**은 다음과 같습니다.
    - 클러스터의 **VPC 보안 그룹**을 만듭니다. 이 보안 그룹을 사용하여 클러스터에 대한 액세스를 제한할 수 있습니다.
        - 예를 들어, 클러스터를 만들 때 할당한 포트와 클러스터에 액세스할 때
        - 이**용할 IP 주소를 사용해 TCP 액세스**를 **허용**하는 이 보안 그룹의 사용자 지정 규칙을 만들 수 있습니다. MemoryDB 클러스터의 기본 포트는 입니다.
            - **6379**
    - EC2 인스턴스(웹 및 애플리케이션 서버)의 VPC 보안 그룹을 만듭니다.
    - 이 보안 그룹은 필요할 경우 **VPC의 라우팅 테이블**을 통한 **EC2 인스턴스 액세스**를 **허용**할 수 있습니다.
        - 예를 들어, 이 보안 그룹에서 TCP가 포트 22를 통해 EC2 인스턴스에 액세스하도록 허용하는 규칙을 설정할 수 있습니다.
    - 클러스터의 보안 그룹에 EC2 인스턴스용으로 생성한 보안 그룹으로부터의 연결을 허용하는 사용자 지정 규칙을 생성합니다.
    - 그러면 보안 그룹의 모든 구성원이 클러스터에 액세스하도록 허용됩니다.

#### VPC 보안 그룹에서 다른 보안 그룹으로부터의 연결을 허용하는 규칙을 만들려면

1. AWS 관리 콘솔에 로그인한 다음 Amazon VPC 콘솔을 엽니다.
2. 왼쪽 탐색 창에서 `[Security Groups]`를 선택합니다.

![Pasted-image-20250410101550.png](/img/이미지 창고/Pasted-image-20250410101550.png)

3. 클러스터에 사용할 보안 그룹을 선택하거나 생성합니다. `[Inbound Rules]`에서 `[Edit Inbound Rules]`을 선택한 다음 `[Add Rule]`을 선택합니다. 이 보안 그룹은 다른 보안 그룹 멤버에 대한 액세스를 허용합니다.

![Pasted-image-20250410101614.png](/img/이미지 창고/Pasted-image-20250410101614.png)
![Pasted-image-20250410101626.png](/img/이미지 창고/Pasted-image-20250410101626.png)

4. `[Type]`에서 `[Custom TCP Rule]`을 선택합니다.
    1. `[Port Range]`에 대해 클러스터를 만들 때 사용한 포트를 지정합니다.
    2. MemoryDB 클러스터의 기본 포트는 입니다. → 6379
    3. `[Source]` 상자에 보안 그룹 ID를 입력합니다. 목록에서 Amazon EC2 인스턴스에 사용할 보안 그룹을 선택합니다.
5. 완료되면 `[Save]`를 선택합니다.


액세스를 활성화했으면 이제 다음 섹션에서 설명하는 것처럼 클러스터에 연결할 준비가 된 것입니다.

## 클러스터에 연결

### 클러스터 엔드포인트 찾기

클러스터가 사용 가능한 상태이고 사용자가 이 클러스터에 **액세스할 수 있는 권한**을 **부여** 받았다면 Amazon **EC2 인스턴스**에 로그인하여 **클러스터에 연결**할 수 있습니다.

이를 수행하려면 먼저 엔드 포인트를 **결정**해야 합니다.

### MemoryDB Cluster에 연결

- 이제 필요한 엔드 포인트가 확보되었으므로 **EC2 인스턴스**에 로그인하여 **클러스터**에 연결할 수 있습니다.
- 다음 예에서는 cli 유틸리티를 사용하여 Ubuntu 22를 사용하는 클러스터에 연결합니다.
- 최신 버전의 cli는 암호화/인증이 활성화된 클러스터를 연결하기 위한 SSL/TLS도 지원합니다.

#### Redis-CLI를 사용하여 메모리 DB 노드에 연결

MemoryDB 노드의 데이터에 액세스하려면 **보안 소켓 계층 (SSL)** 을 사용하는 클라이언트를 사용합니다.
아마존 리눅스 및 아마존 리눅스 2에서 TLS/SSL과 함께 redis-cli를 사용할 수도 있습니다.
redis-cli를 사용하여 아마존 리눅스 2 또는 아마존 리눅스의 MemoryDB 클러스터에 연결하려면
- Amazon Linux2
```shell
sudo yum -y install openssl-devel gcc
wget http://download.redis.io/redis-stable.tar.gz
tar xvzf redis-stable.tar.gz
cd redis-stable
make distclean
make redis-cli BUILD_TLS=yes
sudo install -m 755 src/redis-cli /usr/local/bin/
```
- Amazon Linux
```shell
sudo yum install gcc jemalloc-devel openssl-devel tcl tcl-devel clang wget
wget http://download.redis.io/redis-stable.tar.gz
tar xvzf redis-stable.tar.gz
cd redis-stable
make redis-cli CC=clang BUILD_TLS=yes
sudo install -m 755 src/redis-cli /usr/local/bin/
```
선택적인 make test 명령을 실행하는 것이 좋습니다.  
EC2 인스턴스의 명령 프롬프트에서 다음 명령을 입력하고 클러스터 및 포트의 엔드포인트를 이 예제에 표시된 것으로 대체합니다.
```shell
src/redis-cli -c -h Cluster Endpoint --tls -p 6379
```

### 클러스터 삭제

클러스터가 available 상태면 클러스터를 적극 사용하고 있는지 여부에 관계없이 요금이 부과됩니다.

:::tip MemoryDB 클러스터를 삭제하면 수동 스냅샷이 보존됩니다.
- 클러스터가 삭제되기 전에 최종 스냅샷을 생성할 수도 있습니다.

:::

#### AWS Managment Console 사용

1. Redis용 MemoryDB 콘솔에 접속합니다.
2. 삭제할 클러스터를 선택하려면 클러스터 목록에서 클러스터 삭제를 누릅니다.


### AWS CLI 사용
```shell
aws memorydb delete-cluster --cluster-name my-cluster
```
# Redis를 위한 MemoryDB의 보안

## Redis의 데이터 보호

- 이 모델에서 설명하는 것처럼 AWS는 모든 AWS 클라우드를 실행하는 글로벌 인프라를 보호할 책임이 있습니다.
- 이 인프라에서 호스팅되는 콘텐츠에 대한 제어를 유지하는 것은 **사용자**의 **책임**입니다.
- 이 콘텐츠에는 사용하는 AWS 서비스 서비스의 보안 구성과 관리 작업이 포함돼 있습니다.
- 데이터를 보호하려면 **AWS 계정 보안 인증 정보**를 **보호**하고 AWS IAM Identity Center (successor to AWS Single Sign-On) 또는 AWS Identity and Access Management(IAM)를 통해 **개별 사용자 계정**을 설정하는 것이 좋습니다.
- 이러한 방식에는 각 사용자에게 자신의 직무를 충실히 이행하는 데 필요한 권한만 부여됩니다.
- 또한 다음과 같은 방법으로 데이터를 보호하는 것이 좋습니다.
    - 각 계정마다 **멀티 팩터 인증(MFA)**을 사용합니다.
    - **SSL/TLS**를 사용하여 **AWS 리소스**와 통신합니다.
        - TLS 1.2는 필수이며 **TLS 1.3**을 **권장**합니다.
    - AWS CloudTrail로 API 및 사용자 **활동 로깅**을 **설정**합니다.
    - AWS 암호화 솔루션을 AWS 서비스 내의 모든 기본 보안 컨트롤과 함께 사용합니다.
    - Amazon S3에 저장된 민감한 데이터를 검색하고 보호하는 데 도움이 되는 Amazon Macie와 같은 고급 관리형 보안 서비스를 사용합니다.


## Redis의 데이터 보안

데이터를 안전하게 보관하기 위해 **MemoryDB for Redis** 및 **Amazon EC2**에서는 서버의 데이터에 대한 무단 액세스를 방지하는 메커니즘을 제공합니다.  
MemoryDB는 **클러스터**의 데이터에 대한 **암호화 기능도 제공**합니다.
- 전송 중 데이터 암호화는 클러스터 내 노드 사이 또는 클러스터와 애플리케이션 사이와 같이 한 위치에서 다른 위치로 데이터가 이동 중인 경우 항상 데이터를 암호화합니다.
- 저장 중 암호화는 스냅 샷 작업 중에 트랜잭션 로그와 디스크 상의 데이터를 암호화합니다.



---

#AWS #AWS_MemoryDBForRedis 

---

