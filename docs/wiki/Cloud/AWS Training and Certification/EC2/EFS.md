# Elastic File System
- EFS는 관리형 NFS(Network File System)입니다.
- Network File System이기 때문에 많은 EC2인스턴스에 마운트 될 수 있습니다.
- 서로 다른 가용 영역에 있는 EC2 인스턴스에도 가능합니다.
	- 가용성이 높고
	- 확장성이 뛰어나고
	- 비용도 GP2 EBS 볼륨의 약 3배 입니다.
- 사용량에 따라 비용을 지불하는 방식을 가지므로, 용량을 미리 프로비저닝할 필요는 업습니다.
![Pasted-image-20230804101805.png](/img/이미지 창고/Pasted-image-20230804101805.png)
- EFS는 콘텐츠 관리, 웹 서비스, 데이터 공유, 워드 프레스에 사용됩니다.
- 내부적으로 NFS 프로토콜을 사용합니다.
	- EFS에 대한 액세스를 제어하려면 보안 그룹을 설정해야 합니다.
- 한가지 중욯나 점은 이 기능은 Window가 아닌 Linux 기반 AMI와만 호환 된다는 점입니다.
- KMS를 사용하여 EFS 드라이브에서 미 사용 데이터 암호화를 활성화 할 수 있습니다.
- Linux 포준 파일 시스템인, POSIX 시스템을 사용하며, 표준 파일 API도 있습니다.
- EFS의 좋은 점은 미리 용량을 계획할 필요가 없다는 것입니다.
- 파일 시스템은 자동으로 확장되며, EFS에서 사용하는 데이터 사용량(GiB)대로 비용을 지불합니다.

## EFS Performance & Storage Classes

### EFS Scale
- EFS 스케일에서는 수 천개의 동시 처리 NFS 클라이언트와 10GiB 이상의 처리 량이 가능합니다.
- 페타바이트 규모의 네트워크 파일 시스ㅔㅌㅁ으로 자동 확장할 수 있습니다.

### Performance Mode(set at EFS creation time)
- 범용(기본값)
	- 웹 서버, CMS 등과 같이 지연 시간에 민감한 경우 사용됩니다.
- Max I/O
	- 처리량을 최대화하려면 Max I/O를 선택합니다.
	- 지연 시간이 더 긴 파일 시스템이지만, 처리 량이 크고 병렬성이 높습니다.
	- 빅데이터 애플리케이션이나 미디어 처리가 필요한 경우 유용합니다.
- Throughput Mode
	- 첫 번재는 버스팅입니다.
		- 1TiB의 경우 초당 50MiB에 버스트를 하게 된다면 + 100MiB/s 가 됩니다.
	- 프로비저닝
		- 크기는 용량과 관계없이 처리 량을 설정할 수 있다.
		- 이전에는 스토리지가 늘어날 수록 처리량이 증가했지만, 프로비저닝을 사용하면 1테라바이트에 1GiB/s 를 처리할 수 있습니다.
		- 스토리지에 다라 처리량을 조정하기 때문에 괜찬습니다.
	- 엘라스틱
		- 처리량을 자동으로 확장할 수 있습니다.
			- 예를 들어, 읽기는 초당 최대 3GiB, 쓰기는 초당 1GiB까지 사용 가능합니다.
			- 워크로드에 따라 다릅니다. 즉, 워크로드를 예측 할 수 없을 때 매우 유용합니다.

## EFS - Storage Classes
- Storage Tiers
	- 몇일 후, 파일을 다른 계층으로 옮길 수 있는 기능입니다.
		- 예를 들어, 표준 계층은 자주 액세스하는 파일을 위한 계층이고, 자주 액세스하지 않는 계층은 EFS-IA입니다.
		- 이 계층에서는 파일을 검색할 경우 검색 비용이 발생합니다.
		- 하지만, 파일을 EFS-IA에 저장하면 비용은 더 낮아집니다.
		- EFS-IA를 사용하려면 생명 주기 정책을 사용해야 합니다.
![Pasted-image-20230804110043.png](/img/이미지 창고/Pasted-image-20230804110043.png)
- 만약, 자주사용하는 파일이 EFS 표준 계증에 있다고 가정해보면,
- 그런데 이 파일 중 하나가 60일 이상 액세스되지 않는다는 가정해 봅니다.
- 그렇게 되면, 함께 설정한 생명 주기 정책에 따라 해당 파일은 다른 계층인 EFS-IA로 이동하여 비용을 절감할 수 있습니다.
- 가용성 내구성 측명에는 두 가지 옵션이 있습니다.
	- EFS는 다중 AZ로 설정할 수 있습니다.
	- 프로덕션 사용 사례에 매우 적합합니다.
	- 가용 영역이 다운되더라도, EFS 파일 시스템에 영향을 미치지 않습니다.
- 하지만, 개발용으로는 하나의 영역 EFS 파일 시스템을 사용합니다.
	- 개발에는 좋지만, 하나의 AZ에만 있고, 백업은 기본적으로 사용하도록 설정되어 있으며, 자주 액세스하지 않는 스토리지 계층과 호환되지 않습니다.
	- 따라서 EFS하나의 영역-IAfkrh qnfflqslek.
	- 이를 사용하면 약 90%에 달하는 비용을 절감할 수 있습니다.
-> 시험에서는 언제 EFS시스템을 사용해야하는지, 요구 사항을 검증하고 준수하려면 EFS 네트워크 파일 시스템에서 어떤 옵션을 설정해야 하는지 묻습니다.

# EBS vs EFS 
## EBS 
![Screenshot-2023-08-29-at-5.50.59-AM.png](/img/이미지 창고/Screenshot-2023-08-29-at-5.50.59-AM.png)
- EBS 볼륨은 한 번에 하나의 인스턴스에만 연결이 가능하고, 특정 가용 영역에 한정 된다.
	- gp2 : 디스크 사이즈가 증가하면 IO 또한 증가한다.
	- io1 : IO를 볼륨 크기와 관계 없이 독립적으로 증가 시킬 수 있다.
- EBS를 다른 가용 영역에 옮기고자 할 때는
	- 가장 먼저 EBS의 스냅샷을 찍고
	- 다른 AZ에서 해당 SnapShot을 복원 시켜야 합니다.
	- 그렇게 되면, 해당 AZ에서 EBS 볼륨이 생성됩니다.

:::warning EBS 스냅샷이나 백업을 만들 때는
- 애플리케이션을 핸들링 할 때보다 더 많은 트래픽이 발생 될 가능성이 높다
- 한도 내에서 최대로 트래픽 발생
- 성능 상의 문제가 발생할 수도 있기에, 사용하지 않을 때 백업 해둬야 한다.
:::

- Root EBS는 EC2가 종료되면 기본적으로 종료 됩니다.
	- 원할 경우 이 동작은 비활성화 할 수 있습니다.
:::warning EBS는 네트워크 볼륨을 하나의 인스턴스에 연결할 수 있고, 특정 AZ 내로 한정됩니다.
- 인스턴스 스토어는 EC2 인스턴스에 IO를 최대로 사용하게끔 해주지만, 인스턴스가 망가지면 함께 망가지는 임시 드라이브인 셈입니다.
:::

## EFS
![Pasted-image-20230829093712.png](/img/이미지 창고/Pasted-image-20230829093712.png)
- 무수히 많은 인스턴스와 연결 될 수 있습니다.
- Multi AZ의 EC2인스턴스를 가정해본다면, EFS Mount Target을 사용해 특정 AZ에서 EC2 인스턴스들과 EFS 드라이브를 연결해 줄 수도 있습니다.
	- WordPress와 같은 웹 사이트 파일을 공유할 도 EFS를 쓴다
	- 이는 Liunx 인스턴스에서만 가능하다. 
	- PoSIX 파일 시스템이라서, 리눅스만 호환되기 때문이다.
- EFS는 EBS보다 3배는 더 비쌉니다.
	- 하지만, 비용을 절약하고 싶다면, 스토리지 티어를 EFS-IA를 사용하고
	- 제품 수명 정책을 사용하면 비용을 절감할 수 있습니다.
- EFS는 사용한 만큼 비용이 청구된다.
- EBS는 실제 사용한 양이 아니라 EBS의 드라이브의 크기에 따라서 정해진 사용량을 지불하는 방식에서 차이점이 생긴다.
:::tip EFS는 여러 인스턴스와 연결해야 하는 네트워크 파일 시스템에 적합하다는 걸 알아두면 됩니다.

:::

----

#AWS #AWS_EC2 #AWS_EFS #AWS_DEVLOPER 

---


